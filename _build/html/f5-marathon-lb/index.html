

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>f5-marathon-lb &mdash; F5 Container Integration 0.1_a documentation</title>
  

  
  

  

  
  
    

  

  
  
    <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
  

  

  
    <link rel="top" title="F5 Container Integration 0.1_a documentation" href="../index.html"/>
        <link rel="next" title="Light Weight Proxy (LWP)" href="../lightweight-proxy/index.html"/>
        <link rel="prev" title="Welcome to F5 Container Integrations’s documentation!" href="../index.html"/> 

  
  <script src="../_static/js/modernizr.min.js"></script>

</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search">
          

          
            <a href="../index.html" class="icon icon-home"> F5 Container Integration
          

          
          </a>

          
            
            
              <div class="version">
                0.1_a
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
                <ul class="current">
<li class="toctree-l1 current"><a class="current reference internal" href="#">f5-marathon-lb</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#architecture">Architecture</a></li>
<li class="toctree-l2"><a class="reference internal" href="#configuration">Configuration</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#partitions">Partitions</a></li>
<li class="toctree-l3"><a class="reference internal" href="#application-labels">Application Labels</a></li>
<li class="toctree-l3"><a class="reference internal" href="#building-and-running">Building and Running</a></li>
<li class="toctree-l3"><a class="reference internal" href="#iapps">iApps</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#iapp-labels">iApp Labels</a></li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../lightweight-proxy/index.html">Light Weight Proxy (LWP)</a></li>
<li class="toctree-l1"><a class="reference internal" href="../lwp-controller/index.html">lwp-controller</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" role="navigation" aria-label="top navigation">
        <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
        <a href="../index.html">F5 Container Integration</a>
      </nav>


      
      <div class="wy-nav-content">
        <div class="rst-content">
          

 



<div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="../index.html">Docs</a> &raquo;</li>
      
    <li>f5-marathon-lb</li>
      <li class="wy-breadcrumbs-aside">
        
          
            <a href="../_sources/f5-marathon-lb/index.txt" rel="nofollow"> View page source</a>
          
        
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="f5-marathon-lb">
<h1>f5-marathon-lb<a class="headerlink" href="#f5-marathon-lb" title="Permalink to this headline">¶</a></h1>
<p>f5-marathon-lb is a tool for managing F5 BIG-IP, by consuming
<a class="reference external" href="https://github.com/mesosphere/marathon">Marathon&#8217;s</a> app state.</p>
<div class="section" id="architecture">
<h2>Architecture<a class="headerlink" href="#architecture" title="Permalink to this headline">¶</a></h2>
<p>The f5-marathon-lb is a service discovery and load balancing tool for
Marathon to configure an F5 BIG-IP. It reads the Marathon task
information and dynamically generates BIG-IP configuration details.</p>
<p>f5-marathon-lb listens to the Marathon event stream and automatically
updates the configuration of the BIG-IP and does the following:</p>
<ul class="simple">
<li>Matches Marathon apps by the specified BIG-IP partition</li>
<li>Creates a Virtual Server and pool for each app type in Marathon that
matches the BIG-IP partition</li>
<li>For each task, creates a pool member and adds the member to the
server pool</li>
<li>If the app has a Marathon Health Monitor configured, creates a
corresponding health monitor for each BIG-IP pool member</li>
</ul>
<p>To gather the task information, f5-marathon-lb needs to know where to
find Marathon. The service configuration details are stored in labels.</p>
</div>
<div class="section" id="configuration">
<h2>Configuration<a class="headerlink" href="#configuration" title="Permalink to this headline">¶</a></h2>
<p>First, f5-marathon-lb needs to know how to connect to Marathon and the
BIG-IP, which is done via the command-line arguments:</p>
<div class="code console highlight-default"><div class="highlight"><pre><span></span><span class="n">usage</span><span class="p">:</span> <span class="n">f5_marathon_lb</span><span class="o">.</span><span class="n">py</span> <span class="p">[</span><span class="o">-</span><span class="n">h</span><span class="p">]</span> <span class="p">[</span><span class="o">--</span><span class="n">longhelp</span><span class="p">]</span>
                         <span class="p">[</span><span class="o">--</span><span class="n">marathon</span> <span class="n">MARATHON</span> <span class="p">[</span><span class="n">MARATHON</span> <span class="o">...</span><span class="p">]]</span>
                         <span class="p">[</span><span class="o">--</span><span class="n">listening</span> <span class="n">LISTENING</span><span class="p">]</span> <span class="p">[</span><span class="o">--</span><span class="n">callback</span><span class="o">-</span><span class="n">url</span> <span class="n">CALLBACK_URL</span><span class="p">]</span>
                         <span class="p">[</span><span class="o">--</span><span class="n">hostname</span> <span class="n">HOSTNAME</span><span class="p">]</span> <span class="p">[</span><span class="o">--</span><span class="n">username</span> <span class="n">USERNAME</span><span class="p">]</span>
                         <span class="p">[</span><span class="o">--</span><span class="n">password</span> <span class="n">PASSWORD</span><span class="p">]</span> <span class="p">[</span><span class="o">--</span><span class="n">partition</span> <span class="n">PARTITION</span><span class="p">]</span> <span class="p">[</span><span class="o">--</span><span class="n">sse</span><span class="p">]</span>
                         <span class="p">[</span><span class="o">--</span><span class="n">health</span><span class="o">-</span><span class="n">check</span><span class="p">]</span> <span class="p">[</span><span class="o">--</span><span class="n">syslog</span><span class="o">-</span><span class="n">socket</span> <span class="n">SYSLOG_SOCKET</span><span class="p">]</span>
                         <span class="p">[</span><span class="o">--</span><span class="n">log</span><span class="o">-</span><span class="nb">format</span> <span class="n">LOG_FORMAT</span><span class="p">]</span>
                         <span class="p">[</span><span class="o">--</span><span class="n">marathon</span><span class="o">-</span><span class="n">auth</span><span class="o">-</span><span class="n">credential</span><span class="o">-</span><span class="n">file</span> <span class="n">MARATHON_AUTH_CREDENTIAL_FILE</span><span class="p">]</span>

<span class="n">If</span> <span class="n">an</span> <span class="n">arg</span> <span class="ow">is</span> <span class="n">specified</span> <span class="ow">in</span> <span class="n">more</span> <span class="n">than</span> <span class="n">one</span> <span class="n">place</span><span class="p">,</span> <span class="n">then</span> <span class="n">commandline</span> <span class="n">values</span>
<span class="n">override</span> <span class="n">environment</span> <span class="n">variables</span> <span class="n">which</span> <span class="n">override</span> <span class="n">defaults</span><span class="o">.</span>

<span class="n">optional</span> <span class="n">arguments</span><span class="p">:</span>
  <span class="o">-</span><span class="n">h</span><span class="p">,</span> <span class="o">--</span><span class="n">help</span>            <span class="n">show</span> <span class="n">this</span> <span class="n">help</span> <span class="n">message</span> <span class="ow">and</span> <span class="n">exit</span>
  <span class="o">--</span><span class="n">longhelp</span>            <span class="n">Print</span> <span class="n">out</span> <span class="n">configuration</span> <span class="n">details</span> <span class="p">(</span><span class="n">default</span><span class="p">:</span> <span class="kc">False</span><span class="p">)</span>
  <span class="o">--</span><span class="n">marathon</span> <span class="n">MARATHON</span> <span class="p">[</span><span class="n">MARATHON</span> <span class="o">...</span><span class="p">],</span> <span class="o">-</span><span class="n">m</span> <span class="n">MARATHON</span> <span class="p">[</span><span class="n">MARATHON</span> <span class="o">...</span><span class="p">]</span>
                        <span class="p">[</span><span class="n">required</span><span class="p">]</span> <span class="n">Marathon</span> <span class="n">endpoint</span><span class="p">,</span> <span class="n">eg</span><span class="o">.</span> <span class="o">-</span><span class="n">m</span>
                        <span class="n">http</span><span class="p">:</span><span class="o">//</span><span class="n">marathon1</span><span class="p">:</span><span class="mi">8080</span> <span class="n">http</span><span class="p">:</span><span class="o">//</span><span class="n">marathon2</span><span class="p">:</span><span class="mi">8080</span> <span class="p">[</span><span class="n">env</span> <span class="n">var</span><span class="p">:</span>
                        <span class="n">MARATHON_URL</span><span class="p">]</span> <span class="p">(</span><span class="n">default</span><span class="p">:</span> <span class="kc">None</span><span class="p">)</span>
  <span class="o">--</span><span class="n">listening</span> <span class="n">LISTENING</span><span class="p">,</span> <span class="o">-</span><span class="n">l</span> <span class="n">LISTENING</span>
                        <span class="n">The</span> <span class="n">address</span> <span class="n">this</span> <span class="n">script</span> <span class="n">listens</span> <span class="n">on</span> <span class="k">for</span> <span class="n">marathon</span> <span class="n">events</span>
                        <span class="p">[</span><span class="n">env</span> <span class="n">var</span><span class="p">:</span> <span class="n">F5_CSI_LISTENING_ADDR</span><span class="p">]</span> <span class="p">(</span><span class="n">default</span><span class="p">:</span> <span class="kc">None</span><span class="p">)</span>
  <span class="o">--</span><span class="n">callback</span><span class="o">-</span><span class="n">url</span> <span class="n">CALLBACK_URL</span><span class="p">,</span> <span class="o">-</span><span class="n">u</span> <span class="n">CALLBACK_URL</span>
                        <span class="n">The</span> <span class="n">HTTP</span> <span class="n">address</span> <span class="n">that</span> <span class="n">Marathon</span> <span class="n">can</span> <span class="n">call</span> <span class="n">this</span> <span class="n">script</span>
                        <span class="n">back</span> <span class="n">at</span> <span class="p">(</span><span class="n">http</span><span class="p">:</span><span class="o">//</span><span class="n">lb1</span><span class="p">:</span><span class="mi">8080</span><span class="p">)</span> <span class="p">[</span><span class="n">env</span> <span class="n">var</span><span class="p">:</span>
                        <span class="n">F5_CSI_CALLBACK_URL</span><span class="p">]</span> <span class="p">(</span><span class="n">default</span><span class="p">:</span> <span class="kc">None</span><span class="p">)</span>
  <span class="o">--</span><span class="n">hostname</span> <span class="n">HOSTNAME</span>   <span class="n">F5</span> <span class="n">BIG</span><span class="o">-</span><span class="n">IP</span> <span class="n">hostname</span> <span class="p">[</span><span class="n">env</span> <span class="n">var</span><span class="p">:</span> <span class="n">F5_CSI_BIGIP_HOSTNAME</span><span class="p">]</span>
                        <span class="p">(</span><span class="n">default</span><span class="p">:</span> <span class="kc">None</span><span class="p">)</span>
  <span class="o">--</span><span class="n">username</span> <span class="n">USERNAME</span>   <span class="n">F5</span> <span class="n">BIG</span><span class="o">-</span><span class="n">IP</span> <span class="n">username</span> <span class="p">[</span><span class="n">env</span> <span class="n">var</span><span class="p">:</span> <span class="n">F5_CSI_BIGIP_USERNAME</span><span class="p">]</span>
                        <span class="p">(</span><span class="n">default</span><span class="p">:</span> <span class="kc">None</span><span class="p">)</span>
  <span class="o">--</span><span class="n">password</span> <span class="n">PASSWORD</span>   <span class="n">F5</span> <span class="n">BIG</span><span class="o">-</span><span class="n">IP</span> <span class="n">password</span> <span class="p">[</span><span class="n">env</span> <span class="n">var</span><span class="p">:</span> <span class="n">F5_CSI_BIGIP_PASSWORD</span><span class="p">]</span>
                        <span class="p">(</span><span class="n">default</span><span class="p">:</span> <span class="kc">None</span><span class="p">)</span>
  <span class="o">--</span><span class="n">partition</span> <span class="n">PARTITION</span>
                        <span class="p">[</span><span class="n">required</span><span class="p">]</span> <span class="n">Only</span> <span class="n">generate</span> <span class="n">config</span> <span class="k">for</span> <span class="n">apps</span> <span class="n">which</span> <span class="n">match</span>
                        <span class="n">the</span> <span class="n">specified</span> <span class="n">partition</span><span class="o">.</span> <span class="n">Use</span> <span class="s1">&#39;*&#39;</span> <span class="n">to</span> <span class="n">match</span> <span class="nb">all</span>
                        <span class="n">partitions</span><span class="o">.</span> <span class="n">Can</span> <span class="n">use</span> <span class="n">this</span> <span class="n">arg</span> <span class="n">multiple</span> <span class="n">times</span> <span class="n">to</span> <span class="n">specify</span>
                        <span class="n">multiple</span> <span class="n">partitions</span> <span class="p">[</span><span class="n">env</span> <span class="n">var</span><span class="p">:</span> <span class="n">F5_CSI_PARTITIONS</span><span class="p">]</span>
                        <span class="p">(</span><span class="n">default</span><span class="p">:</span> <span class="p">[])</span>
  <span class="o">--</span><span class="n">sse</span><span class="p">,</span> <span class="o">-</span><span class="n">s</span>             <span class="n">Use</span> <span class="n">Server</span> <span class="n">Sent</span> <span class="n">Events</span> <span class="n">instead</span> <span class="n">of</span> <span class="n">HTTP</span> <span class="n">Callbacks</span> <span class="p">[</span><span class="n">env</span>
                        <span class="n">var</span><span class="p">:</span> <span class="n">F5_CSI_USE_SSE</span><span class="p">]</span> <span class="p">(</span><span class="n">default</span><span class="p">:</span> <span class="kc">False</span><span class="p">)</span>
  <span class="o">--</span><span class="n">health</span><span class="o">-</span><span class="n">check</span><span class="p">,</span> <span class="o">-</span><span class="n">H</span>    <span class="n">If</span> <span class="nb">set</span><span class="p">,</span> <span class="n">respect</span> <span class="n">Marathon</span><span class="s1">&#39;s health check statuses</span>
                        <span class="n">before</span> <span class="n">adding</span> <span class="n">the</span> <span class="n">app</span> <span class="n">instance</span> <span class="n">into</span> <span class="n">the</span> <span class="n">backend</span> <span class="n">pool</span><span class="o">.</span>
                        <span class="p">[</span><span class="n">env</span> <span class="n">var</span><span class="p">:</span> <span class="n">F5_CSI_USE_HEALTHCHECK</span><span class="p">]</span> <span class="p">(</span><span class="n">default</span><span class="p">:</span> <span class="kc">False</span><span class="p">)</span>
  <span class="o">--</span><span class="n">sse</span><span class="o">-</span><span class="n">timeout</span> <span class="n">SSE_TIMEOUT</span><span class="p">,</span> <span class="o">-</span><span class="n">t</span> <span class="n">SSE_TIMEOUT</span>
                        <span class="n">Marathon</span> <span class="n">event</span> <span class="n">stream</span> <span class="n">timeout</span> <span class="p">[</span><span class="n">env</span> <span class="n">var</span><span class="p">:</span>
                        <span class="n">F5_CSI_SSE_TIMEOUT</span><span class="p">]</span> <span class="p">(</span><span class="n">default</span><span class="p">:</span> <span class="mi">30</span><span class="p">)</span>
  <span class="o">--</span><span class="n">syslog</span><span class="o">-</span><span class="n">socket</span> <span class="n">SYSLOG_SOCKET</span>
                        <span class="n">Socket</span> <span class="n">to</span> <span class="n">write</span> <span class="n">syslog</span> <span class="n">messages</span> <span class="n">to</span><span class="o">.</span> <span class="n">Use</span> <span class="s1">&#39;/dev/null&#39;</span> <span class="n">to</span>
                        <span class="n">disable</span> <span class="n">logging</span> <span class="n">to</span> <span class="n">syslog</span> <span class="p">[</span><span class="n">env</span> <span class="n">var</span><span class="p">:</span>
                        <span class="n">F5_CSI_SYSLOG_SOCKET</span><span class="p">]</span> <span class="p">(</span><span class="n">default</span><span class="p">:</span> <span class="o">/</span><span class="n">var</span><span class="o">/</span><span class="n">run</span><span class="o">/</span><span class="n">syslog</span><span class="p">)</span>
  <span class="o">--</span><span class="n">log</span><span class="o">-</span><span class="nb">format</span> <span class="n">LOG_FORMAT</span>
                        <span class="n">Set</span> <span class="n">log</span> <span class="n">message</span> <span class="nb">format</span> <span class="p">[</span><span class="n">env</span> <span class="n">var</span><span class="p">:</span> <span class="n">F5_CSI_LOG_FORMAT</span><span class="p">]</span>
                        <span class="p">(</span><span class="n">default</span><span class="p">:</span> <span class="o">%</span><span class="p">(</span><span class="n">asctime</span><span class="p">)</span><span class="n">s</span> <span class="o">%</span><span class="p">(</span><span class="n">name</span><span class="p">)</span><span class="n">s</span><span class="p">:</span> <span class="o">%</span><span class="p">(</span><span class="n">levelname</span><span class="p">)</span> <span class="o">-</span><span class="mi">8</span><span class="n">s</span><span class="p">:</span>
                        <span class="o">%</span><span class="p">(</span><span class="n">message</span><span class="p">)</span><span class="n">s</span><span class="p">)</span>
  <span class="o">--</span><span class="n">marathon</span><span class="o">-</span><span class="n">auth</span><span class="o">-</span><span class="n">credential</span><span class="o">-</span><span class="n">file</span> <span class="n">MARATHON_AUTH_CREDENTIAL_FILE</span>
                        <span class="n">Path</span> <span class="n">to</span> <span class="n">file</span> <span class="n">containing</span> <span class="n">a</span> <span class="n">user</span><span class="o">/</span><span class="k">pass</span> <span class="k">for</span> <span class="n">the</span> <span class="n">Marathon</span>
                        <span class="n">HTTP</span> <span class="n">API</span> <span class="ow">in</span> <span class="n">the</span> <span class="nb">format</span> <span class="n">of</span> <span class="s1">&#39;user:pass&#39;</span><span class="o">.</span> <span class="p">[</span><span class="n">env</span> <span class="n">var</span><span class="p">:</span>
                        <span class="n">F5_CSI_MARATHON_AUTH</span><span class="p">]</span> <span class="p">(</span><span class="n">default</span><span class="p">:</span> <span class="kc">None</span><span class="p">)</span>
</pre></div>
</div>
<p><em>The **marathon*</em>, <strong>hostname</strong>, <strong>username</strong>, <strong>password</strong>, and
<strong>partition</strong> arguments are mandatory*.</p>
<p>Use the &#8211;partition argument multiple times to specify multiple BIG-IP
partitions to be managed (e.g. &#8211;partition foo &#8211;partition bar).</p>
<div class="section" id="partitions">
<h3>Partitions<a class="headerlink" href="#partitions" title="Permalink to this headline">¶</a></h3>
<p>The partitions managed by f5-marathon-lb must already exist, and
f5-marathon-lb can manage any partitions except &#8220;Common&#8221;.</p>
<p>f5-marathon-lb takes ownership of certain resource types in the
partitions it is given to manage, and modifications to these resource
types in other ways (GUI, REST, etc) than via f5-marathon-lb will lead
to unpredictable behavior.</p>
<p>The resource types managed by f5-marathon-lb are:</p>
<ul class="simple">
<li>Virtual Servers</li>
<li>Virtual Addresses</li>
<li>Pools</li>
<li>Pool Members</li>
<li>Nodes</li>
<li>Health Monitors</li>
<li>Application Services</li>
</ul>
<p>To prevent conflict with f5-marathon-lb, <strong>no</strong> user-managed items
should be configured within partitions that are managed by
f5-marathon-lb.</p>
</div>
<div class="section" id="application-labels">
<h3>Application Labels<a class="headerlink" href="#application-labels" title="Permalink to this headline">¶</a></h3>
<p>Applications to be managed by f5-marathon-lb are identified and
configured via their <em>Marathon Labels</em>. Some labels are specified <em>per
service port</em>. These are denoted with the <code class="docutils literal"><span class="pre">{n}</span></code> parameter in the label
key, where <code class="docutils literal"><span class="pre">{n}</span></code> corresponds to the service port index, beginning at
<code class="docutils literal"><span class="pre">0</span></code>.</p>
<p>The list of labels which can be specified are:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">F5_PARTITION</span>

   <span class="n">The</span> <span class="n">BIG</span><span class="o">-</span><span class="n">IP</span> <span class="n">partition</span> <span class="n">to</span> <span class="n">be</span> <span class="n">configured</span>
   <span class="n">Resources</span> <span class="n">like</span> <span class="n">virtual</span> <span class="n">servers</span> <span class="ow">and</span> <span class="n">pool</span> <span class="n">members</span> <span class="n">are</span> <span class="n">configured</span> <span class="ow">in</span> <span class="n">this</span> <span class="n">partition</span> <span class="n">on</span> <span class="n">BIG</span><span class="o">-</span><span class="n">IP</span><span class="o">.</span>  <span class="n">It</span> <span class="n">must</span> <span class="n">be</span> <span class="n">one</span> <span class="n">of</span> <span class="n">the</span> <span class="n">partitions</span> <span class="n">that</span> <span class="n">f5</span><span class="o">-</span><span class="n">marathon</span><span class="o">-</span><span class="n">lb</span> <span class="n">owns</span> <span class="p">(</span><span class="n">via</span> <span class="n">the</span> <span class="s2">&quot;--partition&quot;</span> <span class="n">argument</span> <span class="n">to</span> <span class="n">f5</span><span class="o">-</span><span class="n">marathon</span><span class="o">-</span><span class="n">lb</span><span class="p">)</span><span class="o">.</span>

<span class="n">F5_</span><span class="p">{</span><span class="n">n</span><span class="p">}</span><span class="n">_BIND_ADDR</span>

   <span class="n">Bind</span> <span class="n">to</span> <span class="n">the</span> <span class="n">specific</span> <span class="n">address</span> <span class="k">for</span> <span class="n">the</span> <span class="n">service</span>
   <span class="n">Ex</span><span class="p">:</span> <span class="s2">&quot;F5_0_BIND_ADDR&quot;</span><span class="p">:</span> <span class="s2">&quot;10.0.0.42&quot;</span>

<span class="n">F5_</span><span class="p">{</span><span class="n">n</span><span class="p">}</span><span class="n">_PORT</span>

   <span class="n">Bind</span> <span class="n">to</span> <span class="n">the</span> <span class="n">specific</span> <span class="n">port</span> <span class="k">for</span> <span class="n">the</span> <span class="n">service</span>
   <span class="n">This</span> <span class="n">overrides</span> <span class="n">the</span> <span class="n">servicePort</span> <span class="n">which</span> <span class="n">has</span> <span class="n">to</span> <span class="n">be</span> <span class="n">unique</span>
   <span class="n">Ex</span><span class="p">:</span> <span class="s2">&quot;F5_0_PORT&quot;</span><span class="p">:</span> <span class="s2">&quot;80&quot;</span>

<span class="n">F5_</span><span class="p">{</span><span class="n">n</span><span class="p">}</span><span class="n">_MODE</span>

   <span class="n">Set</span> <span class="n">the</span> <span class="n">connection</span> <span class="n">mode</span> <span class="n">to</span> <span class="n">either</span> <span class="n">TCP</span> <span class="ow">or</span> <span class="n">HTTP</span><span class="o">.</span> <span class="n">The</span> <span class="n">default</span> <span class="ow">is</span> <span class="n">TCP</span><span class="o">.</span>
   <span class="n">Ex</span><span class="p">:</span> <span class="s2">&quot;F5_0_MODE&quot;</span><span class="p">:</span> <span class="s2">&quot;http&quot;</span>

<span class="n">F5_</span><span class="p">{</span><span class="n">n</span><span class="p">}</span><span class="n">_BALANCE</span>

   <span class="n">Set</span> <span class="n">the</span> <span class="n">load</span> <span class="n">balancing</span> <span class="n">algorithm</span> <span class="n">to</span> <span class="n">be</span> <span class="n">used</span> <span class="ow">in</span> <span class="n">a</span> <span class="n">backend</span><span class="o">.</span> <span class="n">The</span> <span class="n">default</span> <span class="ow">is</span> <span class="n">roundrobin</span><span class="o">.</span>
   <span class="n">Ex</span><span class="p">:</span> <span class="s2">&quot;F5_0_BALANCE&quot;</span><span class="p">:</span> <span class="s2">&quot;leastconn&quot;</span>

<span class="n">F5_</span><span class="p">{</span><span class="n">n</span><span class="p">}</span><span class="n">_SSL_PROFILE</span>

   <span class="n">Set</span> <span class="n">the</span> <span class="n">SSL</span> <span class="n">profile</span> <span class="n">to</span> <span class="n">be</span> <span class="n">used</span> <span class="k">for</span> <span class="n">the</span> <span class="n">HTTPS</span> <span class="n">Virtual</span> <span class="n">Server</span>
   <span class="n">Ex</span><span class="p">:</span> <span class="s2">&quot;F5_0_SSL_PROFILE&quot;</span><span class="p">:</span> <span class="s2">&quot;Common/clentssl&quot;</span>
</pre></div>
</div>
</div>
<div class="section" id="building-and-running">
<h3>Building and Running<a class="headerlink" href="#building-and-running" title="Permalink to this headline">¶</a></h3>
<p>The following shows how to build and launch f5-marathon-lb as a Docker
container.</p>
<p>Build a Docker container:</p>
<div class="code console highlight-default"><div class="highlight"><pre><span></span><span class="n">docker</span> <span class="n">build</span> <span class="o">-</span><span class="n">t</span> <span class="n">docker</span><span class="o">-</span><span class="n">registry</span><span class="o">.</span><span class="n">pdbld</span><span class="o">.</span><span class="n">f5net</span><span class="o">.</span><span class="n">com</span><span class="o">/</span><span class="n">darzins</span><span class="o">/</span><span class="n">f5</span><span class="o">-</span><span class="n">marathon</span><span class="o">-</span><span class="n">lb</span><span class="p">:</span><span class="n">latest</span> <span class="o">.</span>
</pre></div>
</div>
<p>Push it to a Docker registry:</p>
<div class="code console highlight-default"><div class="highlight"><pre><span></span><span class="n">docker</span> <span class="n">push</span> <span class="n">docker</span><span class="o">-</span><span class="n">registry</span><span class="o">.</span><span class="n">pdbld</span><span class="o">.</span><span class="n">f5net</span><span class="o">.</span><span class="n">com</span><span class="o">/</span><span class="n">darzins</span><span class="o">/</span><span class="n">f5</span><span class="o">-</span><span class="n">marathon</span><span class="o">-</span><span class="n">lb</span><span class="p">:</span><span class="n">latest</span>
</pre></div>
</div>
<p>Launch it in Marathon:</p>
<div class="code console highlight-default"><div class="highlight"><pre><span></span><span class="n">curl</span> <span class="o">-</span><span class="n">X</span> <span class="n">POST</span> <span class="o">-</span><span class="n">H</span> <span class="s2">&quot;Content-Type: application/json&quot;</span> <span class="n">http</span><span class="p">:</span><span class="o">//</span><span class="mf">10.141</span><span class="o">.</span><span class="mf">141.10</span><span class="p">:</span><span class="mi">8080</span><span class="o">/</span><span class="n">v2</span><span class="o">/</span><span class="n">apps</span> <span class="o">-</span><span class="n">d</span> <span class="nd">@f5</span><span class="o">-</span><span class="n">marathon</span><span class="o">-</span><span class="n">lb</span><span class="o">.</span><span class="n">json</span>
</pre></div>
</div>
<p>Where &#8220;f5-marathon-lb.json&#8221; contains the details needed to deploy the
container in Marathon, e.g.:</p>
<div class="code json highlight-default"><div class="highlight"><pre><span></span><span class="p">{</span>
  <span class="s2">&quot;id&quot;</span><span class="p">:</span> <span class="s2">&quot;f5-marathon-lb&quot;</span><span class="p">,</span>
  <span class="s2">&quot;cpus&quot;</span><span class="p">:</span> <span class="mf">0.5</span><span class="p">,</span>
  <span class="s2">&quot;mem&quot;</span><span class="p">:</span> <span class="mf">128.0</span><span class="p">,</span>
  <span class="s2">&quot;instances&quot;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span>
  <span class="s2">&quot;container&quot;</span><span class="p">:</span> <span class="p">{</span>
    <span class="s2">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;DOCKER&quot;</span><span class="p">,</span>
    <span class="s2">&quot;forcePullImage&quot;</span><span class="p">:</span> <span class="n">true</span><span class="p">,</span>
    <span class="s2">&quot;docker&quot;</span><span class="p">:</span> <span class="p">{</span>
      <span class="s2">&quot;image&quot;</span><span class="p">:</span> <span class="s2">&quot;docker-registry.pdbld.f5net.com/darzins/f5-marathon-lb:latest&quot;</span><span class="p">,</span>
      <span class="s2">&quot;network&quot;</span><span class="p">:</span> <span class="s2">&quot;BRIDGE&quot;</span>
    <span class="p">}</span>
  <span class="p">},</span>
  <span class="s2">&quot;args&quot;</span><span class="p">:</span> <span class="p">[</span>
    <span class="s2">&quot;sse&quot;</span><span class="p">,</span>
    <span class="s2">&quot;--marathon&quot;</span><span class="p">,</span> <span class="s2">&quot;http://10.141.141.10:8080&quot;</span><span class="p">,</span>
    <span class="s2">&quot;--partition&quot;</span><span class="p">,</span> <span class="s2">&quot;mesos_1&quot;</span><span class="p">,</span>
    <span class="s2">&quot;--hostname&quot;</span><span class="p">,</span> <span class="s2">&quot;10.128.1.145&quot;</span><span class="p">,</span>
    <span class="s2">&quot;--username&quot;</span><span class="p">,</span> <span class="s2">&quot;admin&quot;</span><span class="p">,</span>
    <span class="s2">&quot;--password&quot;</span><span class="p">,</span> <span class="s2">&quot;default&quot;</span>
  <span class="p">]</span>
<span class="p">}</span>
</pre></div>
</div>
<p>Or launch it this way, using <strong>env</strong> variables instead of <strong>args</strong>.</p>
<div class="code json highlight-default"><div class="highlight"><pre><span></span><span class="p">{</span>
  <span class="s2">&quot;id&quot;</span><span class="p">:</span> <span class="s2">&quot;f5-mlb&quot;</span><span class="p">,</span>
  <span class="s2">&quot;cpus&quot;</span><span class="p">:</span> <span class="mf">0.5</span><span class="p">,</span>
  <span class="s2">&quot;mem&quot;</span><span class="p">:</span> <span class="mf">128.0</span><span class="p">,</span>
  <span class="s2">&quot;instances&quot;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span>
  <span class="s2">&quot;container&quot;</span><span class="p">:</span> <span class="p">{</span>
    <span class="s2">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;DOCKER&quot;</span><span class="p">,</span>
    <span class="s2">&quot;forcePullImage&quot;</span><span class="p">:</span> <span class="n">true</span><span class="p">,</span>
    <span class="s2">&quot;docker&quot;</span><span class="p">:</span> <span class="p">{</span>
      <span class="s2">&quot;image&quot;</span><span class="p">:</span> <span class="s2">&quot;docker-registry.pdbld.f5net.com/velcro/f5-marathon-lb:latest&quot;</span><span class="p">,</span>
      <span class="s2">&quot;network&quot;</span><span class="p">:</span> <span class="s2">&quot;BRIDGE&quot;</span>
    <span class="p">}</span>
  <span class="p">},</span>
  <span class="s2">&quot;env&quot;</span><span class="p">:</span> <span class="p">{</span>
    <span class="s2">&quot;F5_CSI_USE_SSE&quot;</span><span class="p">:</span> <span class="s2">&quot;True&quot;</span><span class="p">,</span>
    <span class="s2">&quot;MARATHON_URL&quot;</span><span class="p">:</span> <span class="s2">&quot;http://10.141.141.10:8080&quot;</span><span class="p">,</span>
    <span class="s2">&quot;F5_CSI_PARTITIONS&quot;</span><span class="p">:</span> <span class="s2">&quot;[mesos_1, mesos_test]&quot;</span><span class="p">,</span>
    <span class="s2">&quot;F5_CSI_BIGIP_HOSTNAME&quot;</span><span class="p">:</span> <span class="s2">&quot;10.128.1.145&quot;</span><span class="p">,</span>
    <span class="s2">&quot;F5_CSI_BIGIP_USERNAME&quot;</span><span class="p">:</span> <span class="s2">&quot;admin&quot;</span><span class="p">,</span>
    <span class="s2">&quot;F5_CSI_BIGIP_PASSWORD&quot;</span><span class="p">:</span> <span class="s2">&quot;default&quot;</span>
  <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
<p>The following is an example for an application deployment in Marathon,
with the appropriate f5-marathon-lb labels configured. In this example,
the app (server-app4) has three service ports configured, but only the
first two are exposed via the BIG-IP (i.e. only port indices 0 and 1 are
configured in the <em>labels</em> section). Marathon health monitors are
configured for all three service ports.</p>
<div class="code json highlight-default"><div class="highlight"><pre><span></span><span class="p">{</span>
  <span class="s2">&quot;id&quot;</span><span class="p">:</span> <span class="s2">&quot;server-app4&quot;</span><span class="p">,</span>
  <span class="s2">&quot;cpus&quot;</span><span class="p">:</span> <span class="mf">0.1</span><span class="p">,</span>
  <span class="s2">&quot;mem&quot;</span><span class="p">:</span> <span class="mf">16.0</span><span class="p">,</span>
  <span class="s2">&quot;instances&quot;</span><span class="p">:</span> <span class="mi">2</span><span class="p">,</span>
  <span class="s2">&quot;container&quot;</span><span class="p">:</span> <span class="p">{</span>
    <span class="s2">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;DOCKER&quot;</span><span class="p">,</span>
    <span class="s2">&quot;docker&quot;</span><span class="p">:</span> <span class="p">{</span>
      <span class="s2">&quot;image&quot;</span><span class="p">:</span> <span class="s2">&quot;edarzins/node-web-app&quot;</span><span class="p">,</span>
      <span class="s2">&quot;network&quot;</span><span class="p">:</span> <span class="s2">&quot;BRIDGE&quot;</span><span class="p">,</span>
      <span class="s2">&quot;forcePullImage&quot;</span><span class="p">:</span> <span class="n">false</span><span class="p">,</span>
      <span class="s2">&quot;portMappings&quot;</span><span class="p">:</span> <span class="p">[</span>
        <span class="p">{</span> <span class="s2">&quot;containerPort&quot;</span><span class="p">:</span> <span class="mi">8088</span><span class="p">,</span>
          <span class="s2">&quot;hostPort&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
          <span class="s2">&quot;protocol&quot;</span><span class="p">:</span> <span class="s2">&quot;tcp&quot;</span> <span class="p">},</span>
        <span class="p">{</span> <span class="s2">&quot;containerPort&quot;</span><span class="p">:</span> <span class="mi">8188</span><span class="p">,</span>
          <span class="s2">&quot;hostPort&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
          <span class="s2">&quot;protocol&quot;</span><span class="p">:</span> <span class="s2">&quot;tcp&quot;</span> <span class="p">},</span>
        <span class="p">{</span> <span class="s2">&quot;containerPort&quot;</span><span class="p">:</span> <span class="mi">8288</span><span class="p">,</span>
          <span class="s2">&quot;hostPort&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
          <span class="s2">&quot;protocol&quot;</span><span class="p">:</span> <span class="s2">&quot;tcp&quot;</span> <span class="p">}</span>
      <span class="p">]</span>
    <span class="p">}</span>
  <span class="p">},</span>
  <span class="s2">&quot;labels&quot;</span><span class="p">:</span> <span class="p">{</span>
    <span class="s2">&quot;F5_PARTITION&quot;</span><span class="p">:</span> <span class="s2">&quot;mesos&quot;</span><span class="p">,</span>
    <span class="s2">&quot;F5_0_BIND_ADDR&quot;</span><span class="p">:</span> <span class="s2">&quot;10.128.10.240&quot;</span><span class="p">,</span>
    <span class="s2">&quot;F5_0_MODE&quot;</span><span class="p">:</span> <span class="s2">&quot;http&quot;</span><span class="p">,</span>
    <span class="s2">&quot;F5_0_PORT&quot;</span><span class="p">:</span> <span class="s2">&quot;8080&quot;</span><span class="p">,</span>
    <span class="s2">&quot;F5_1_BIND_ADDR&quot;</span><span class="p">:</span> <span class="s2">&quot;10.128.10.242&quot;</span><span class="p">,</span>
    <span class="s2">&quot;F5_1_MODE&quot;</span><span class="p">:</span> <span class="s2">&quot;http&quot;</span><span class="p">,</span>
    <span class="s2">&quot;F5_1_PORT&quot;</span><span class="p">:</span> <span class="s2">&quot;8090&quot;</span>
  <span class="p">},</span>
  <span class="s2">&quot;healthChecks&quot;</span><span class="p">:</span> <span class="p">[</span>
    <span class="p">{</span>
      <span class="s2">&quot;protocol&quot;</span><span class="p">:</span> <span class="s2">&quot;HTTP&quot;</span><span class="p">,</span>
      <span class="s2">&quot;portIndex&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
      <span class="s2">&quot;path&quot;</span><span class="p">:</span> <span class="s2">&quot;/&quot;</span><span class="p">,</span>
      <span class="s2">&quot;gracePeriodSeconds&quot;</span><span class="p">:</span> <span class="mi">5</span><span class="p">,</span>
      <span class="s2">&quot;intervalSeconds&quot;</span><span class="p">:</span> <span class="mi">20</span><span class="p">,</span>
      <span class="s2">&quot;maxConsecutiveFailures&quot;</span><span class="p">:</span> <span class="mi">3</span>
    <span class="p">},</span>
    <span class="p">{</span>
      <span class="s2">&quot;protocol&quot;</span><span class="p">:</span> <span class="s2">&quot;HTTP&quot;</span><span class="p">,</span>
      <span class="s2">&quot;portIndex&quot;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span>
      <span class="s2">&quot;path&quot;</span><span class="p">:</span> <span class="s2">&quot;/&quot;</span><span class="p">,</span>
      <span class="s2">&quot;gracePeriodSeconds&quot;</span><span class="p">:</span> <span class="mi">5</span><span class="p">,</span>
      <span class="s2">&quot;intervalSeconds&quot;</span><span class="p">:</span> <span class="mi">20</span><span class="p">,</span>
      <span class="s2">&quot;maxConsecutiveFailures&quot;</span><span class="p">:</span> <span class="mi">3</span>
    <span class="p">},</span>
    <span class="p">{</span>
      <span class="s2">&quot;protocol&quot;</span><span class="p">:</span> <span class="s2">&quot;HTTP&quot;</span><span class="p">,</span>
      <span class="s2">&quot;portIndex&quot;</span><span class="p">:</span> <span class="mi">2</span><span class="p">,</span>
      <span class="s2">&quot;path&quot;</span><span class="p">:</span> <span class="s2">&quot;/&quot;</span><span class="p">,</span>
      <span class="s2">&quot;gracePeriodSeconds&quot;</span><span class="p">:</span> <span class="mi">5</span><span class="p">,</span>
      <span class="s2">&quot;intervalSeconds&quot;</span><span class="p">:</span> <span class="mi">20</span><span class="p">,</span>
      <span class="s2">&quot;maxConsecutiveFailures&quot;</span><span class="p">:</span> <span class="mi">3</span>
    <span class="p">}</span>
  <span class="p">]</span>
<span class="p">}</span>
</pre></div>
</div>
<p>The following shows the BIG-IP configuration produced by f5-marathon-lb
for the preceding Marathon configuration; showing virtual servers,
pools, and health monitors.</p>
<p>If a Marathon health monitor exists for a service port, f5-marathon-lb
will also create a health monitor for it on the BIG-IP. The exception to
this is when the &#8220;&#8211;health-check&#8221; option is used when starting
f5-marathon-lb. If this option is set, f5-marathon-lb will respect the
Marathon health status for the service port before adding it to the
backend pool.</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">ltm</span> <span class="n">monitor</span> <span class="n">http</span> <span class="n">server</span><span class="o">-</span><span class="n">app4_10</span><span class="o">.</span><span class="mf">128.10</span><span class="o">.</span><span class="mi">240</span><span class="n">_8080</span> <span class="p">{</span>
    <span class="n">adaptive</span> <span class="n">disabled</span>
    <span class="n">defaults</span><span class="o">-</span><span class="kn">from</span> <span class="o">/</span><span class="n">Common</span><span class="o">/</span><span class="n">http</span>
    <span class="n">destination</span> <span class="o">*</span><span class="p">:</span><span class="o">*</span>
    <span class="n">interval</span> <span class="mi">20</span>
    <span class="n">ip</span><span class="o">-</span><span class="n">dscp</span> <span class="mi">0</span>
    <span class="n">partition</span> <span class="n">mesos</span>
    <span class="n">send</span> <span class="s2">&quot;GET /</span><span class="se">\r\n</span><span class="s2">&quot;</span>
    <span class="n">time</span><span class="o">-</span><span class="n">until</span><span class="o">-</span><span class="n">up</span> <span class="mi">0</span>
    <span class="n">timeout</span> <span class="mi">61</span>
<span class="p">}</span>
<span class="n">ltm</span> <span class="n">monitor</span> <span class="n">http</span> <span class="n">server</span><span class="o">-</span><span class="n">app4_10</span><span class="o">.</span><span class="mf">128.10</span><span class="o">.</span><span class="mi">242</span><span class="n">_8090</span> <span class="p">{</span>
    <span class="n">adaptive</span> <span class="n">disabled</span>
    <span class="n">defaults</span><span class="o">-</span><span class="kn">from</span> <span class="o">/</span><span class="n">Common</span><span class="o">/</span><span class="n">http</span>
    <span class="n">destination</span> <span class="o">*</span><span class="p">:</span><span class="o">*</span>
    <span class="n">interval</span> <span class="mi">20</span>
    <span class="n">ip</span><span class="o">-</span><span class="n">dscp</span> <span class="mi">0</span>
    <span class="n">partition</span> <span class="n">mesos</span>
    <span class="n">send</span> <span class="s2">&quot;GET /</span><span class="se">\r\n</span><span class="s2">&quot;</span>
    <span class="n">time</span><span class="o">-</span><span class="n">until</span><span class="o">-</span><span class="n">up</span> <span class="mi">0</span>
    <span class="n">timeout</span> <span class="mi">61</span>
<span class="p">}</span>
<span class="n">ltm</span> <span class="n">node</span> <span class="mf">10.141</span><span class="o">.</span><span class="mf">141.10</span> <span class="p">{</span>
    <span class="n">address</span> <span class="mf">10.141</span><span class="o">.</span><span class="mf">141.10</span>
    <span class="n">partition</span> <span class="n">mesos</span>
    <span class="n">session</span> <span class="n">monitor</span><span class="o">-</span><span class="n">enabled</span>
    <span class="n">state</span> <span class="n">up</span>
<span class="p">}</span>
<span class="n">ltm</span> <span class="n">persistence</span> <span class="k">global</span><span class="o">-</span><span class="n">settings</span> <span class="p">{</span> <span class="p">}</span>
<span class="n">ltm</span> <span class="n">pool</span> <span class="n">server</span><span class="o">-</span><span class="n">app4_10</span><span class="o">.</span><span class="mf">128.10</span><span class="o">.</span><span class="mi">240</span><span class="n">_8080</span> <span class="p">{</span>
    <span class="n">members</span> <span class="p">{</span>
        <span class="mf">10.141</span><span class="o">.</span><span class="mf">141.10</span><span class="p">:</span><span class="mi">31383</span> <span class="p">{</span>
            <span class="n">address</span> <span class="mf">10.141</span><span class="o">.</span><span class="mf">141.10</span>
            <span class="n">session</span> <span class="n">monitor</span><span class="o">-</span><span class="n">enabled</span>
            <span class="n">state</span> <span class="n">up</span>
        <span class="p">}</span>
        <span class="mf">10.141</span><span class="o">.</span><span class="mf">141.10</span><span class="p">:</span><span class="mi">31775</span> <span class="p">{</span>
            <span class="n">address</span> <span class="mf">10.141</span><span class="o">.</span><span class="mf">141.10</span>
            <span class="n">session</span> <span class="n">monitor</span><span class="o">-</span><span class="n">enabled</span>
            <span class="n">state</span> <span class="n">up</span>
        <span class="p">}</span>
    <span class="p">}</span>
    <span class="n">monitor</span> <span class="n">server</span><span class="o">-</span><span class="n">app4_10</span><span class="o">.</span><span class="mf">128.10</span><span class="o">.</span><span class="mi">240</span><span class="n">_8080</span>
    <span class="n">partition</span> <span class="n">mesos</span>
<span class="p">}</span>
<span class="n">ltm</span> <span class="n">pool</span> <span class="n">server</span><span class="o">-</span><span class="n">app4_10</span><span class="o">.</span><span class="mf">128.10</span><span class="o">.</span><span class="mi">242</span><span class="n">_8090</span> <span class="p">{</span>
    <span class="n">members</span> <span class="p">{</span>
        <span class="mf">10.141</span><span class="o">.</span><span class="mf">141.10</span><span class="p">:</span><span class="mi">31384</span> <span class="p">{</span>
            <span class="n">address</span> <span class="mf">10.141</span><span class="o">.</span><span class="mf">141.10</span>
            <span class="n">session</span> <span class="n">monitor</span><span class="o">-</span><span class="n">enabled</span>
            <span class="n">state</span> <span class="n">up</span>
        <span class="p">}</span>
        <span class="mf">10.141</span><span class="o">.</span><span class="mf">141.10</span><span class="p">:</span><span class="mi">31776</span> <span class="p">{</span>
            <span class="n">address</span> <span class="mf">10.141</span><span class="o">.</span><span class="mf">141.10</span>
            <span class="n">session</span> <span class="n">monitor</span><span class="o">-</span><span class="n">enabled</span>
            <span class="n">state</span> <span class="n">up</span>
        <span class="p">}</span>
    <span class="p">}</span>
    <span class="n">monitor</span> <span class="n">server</span><span class="o">-</span><span class="n">app4_10</span><span class="o">.</span><span class="mf">128.10</span><span class="o">.</span><span class="mi">242</span><span class="n">_8090</span>
    <span class="n">partition</span> <span class="n">mesos</span>
<span class="p">}</span>
<span class="n">ltm</span> <span class="n">virtual</span> <span class="n">server</span><span class="o">-</span><span class="n">app4_10</span><span class="o">.</span><span class="mf">128.10</span><span class="o">.</span><span class="mi">240</span><span class="n">_8080</span> <span class="p">{</span>
    <span class="n">destination</span> <span class="mf">10.128</span><span class="o">.</span><span class="mf">10.240</span><span class="p">:</span><span class="n">webcache</span>
    <span class="n">ip</span><span class="o">-</span><span class="n">protocol</span> <span class="n">tcp</span>
    <span class="n">mask</span> <span class="mf">255.255</span><span class="o">.</span><span class="mf">255.255</span>
    <span class="n">partition</span> <span class="n">mesos</span>
    <span class="n">pool</span> <span class="n">server</span><span class="o">-</span><span class="n">app4_10</span><span class="o">.</span><span class="mf">128.10</span><span class="o">.</span><span class="mi">240</span><span class="n">_8080</span>
    <span class="n">profiles</span> <span class="p">{</span>
        <span class="o">/</span><span class="n">Common</span><span class="o">/</span><span class="n">http</span> <span class="p">{</span> <span class="p">}</span>
        <span class="o">/</span><span class="n">Common</span><span class="o">/</span><span class="n">tcp</span> <span class="p">{</span> <span class="p">}</span>
    <span class="p">}</span>
    <span class="n">source</span> <span class="mf">0.0</span><span class="o">.</span><span class="mf">0.0</span><span class="o">/</span><span class="mi">0</span>
    <span class="n">source</span><span class="o">-</span><span class="n">address</span><span class="o">-</span><span class="n">translation</span> <span class="p">{</span>
        <span class="nb">type</span> <span class="n">automap</span>
    <span class="p">}</span>
    <span class="n">vs</span><span class="o">-</span><span class="n">index</span> <span class="mi">153</span>
<span class="p">}</span>
<span class="n">ltm</span> <span class="n">virtual</span> <span class="n">server</span><span class="o">-</span><span class="n">app4_10</span><span class="o">.</span><span class="mf">128.10</span><span class="o">.</span><span class="mi">242</span><span class="n">_8090</span> <span class="p">{</span>
    <span class="n">destination</span> <span class="mf">10.128</span><span class="o">.</span><span class="mf">10.242</span><span class="p">:</span><span class="mi">8090</span>
    <span class="n">ip</span><span class="o">-</span><span class="n">protocol</span> <span class="n">tcp</span>
    <span class="n">mask</span> <span class="mf">255.255</span><span class="o">.</span><span class="mf">255.255</span>
    <span class="n">partition</span> <span class="n">mesos</span>
    <span class="n">pool</span> <span class="n">server</span><span class="o">-</span><span class="n">app4_10</span><span class="o">.</span><span class="mf">128.10</span><span class="o">.</span><span class="mi">242</span><span class="n">_8090</span>
    <span class="n">profiles</span> <span class="p">{</span>
        <span class="o">/</span><span class="n">Common</span><span class="o">/</span><span class="n">http</span> <span class="p">{</span> <span class="p">}</span>
        <span class="o">/</span><span class="n">Common</span><span class="o">/</span><span class="n">tcp</span> <span class="p">{</span> <span class="p">}</span>
    <span class="p">}</span>
    <span class="n">source</span> <span class="mf">0.0</span><span class="o">.</span><span class="mf">0.0</span><span class="o">/</span><span class="mi">0</span>
    <span class="n">source</span><span class="o">-</span><span class="n">address</span><span class="o">-</span><span class="n">translation</span> <span class="p">{</span>
        <span class="nb">type</span> <span class="n">automap</span>
    <span class="p">}</span>
    <span class="n">vs</span><span class="o">-</span><span class="n">index</span> <span class="mi">154</span>
<span class="p">}</span>
</pre></div>
</div>
</div>
<div class="section" id="iapps">
<h3>iApps<a class="headerlink" href="#iapps" title="Permalink to this headline">¶</a></h3>
<p>iApps is the BIG-IP system framework for deploying services-based,
template-driven configurations on BIG-IP systems running TMOS 11.0.0 and
later. It consists of three components: Templates, Application Services,
and Analytics. An iApps Template is where the application is described
and the objects (required and optional) are defined through presentation
and implementation language. An iApps Application Service is the
deployment process of an iApps Template which bundles all of the
configuration options for a particular application together.</p>
<div class="section" id="iapp-labels">
<h4>iApp Labels<a class="headerlink" href="#iapp-labels" title="Permalink to this headline">¶</a></h4>
<p>f5-marathon-lb can be used to instantiate and manage an iApp Application
Service, with the iApp template and variables specicified via the LABELS
in a Marathon application.</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">F5_</span><span class="p">{</span><span class="n">n</span><span class="p">}</span><span class="n">_IAPP_TEMPLATE</span>

   <span class="n">The</span> <span class="n">iApp</span> <span class="n">template</span> <span class="n">to</span> <span class="n">create</span> <span class="n">the</span> <span class="n">Application</span> <span class="n">Service</span><span class="o">.</span> <span class="n">The</span> <span class="n">template</span> <span class="n">must</span> <span class="n">already</span> <span class="n">be</span> <span class="n">installed</span> <span class="n">on</span> <span class="n">the</span> <span class="n">BIG</span><span class="o">-</span><span class="n">IP</span>
   <span class="n">Ex</span><span class="p">:</span> <span class="s2">&quot;F5_0_IAPP_TEMPLATE&quot;</span><span class="p">:</span> <span class="s2">&quot;/Common/f5.http&quot;</span>

<span class="n">F5_</span><span class="p">{</span><span class="n">n</span><span class="p">}</span><span class="n">_IAPP_OPTION_</span><span class="o">*</span>

   <span class="n">The</span> <span class="n">predicate</span> <span class="n">that</span> <span class="n">defines</span> <span class="n">configuration</span> <span class="n">options</span> <span class="k">for</span> <span class="n">the</span> <span class="n">service</span>
   <span class="n">Ex</span><span class="p">:</span> <span class="s2">&quot;F5_0_IAPP_OPTION_description&quot;</span><span class="p">:</span> <span class="s2">&quot;This is a test iApp&quot;</span>

<span class="n">F5_</span><span class="p">{</span><span class="n">n</span><span class="p">}</span><span class="n">_IAPP_VARIABLE_</span><span class="o">*</span>

   <span class="n">The</span> <span class="n">predicate</span> <span class="n">that</span> <span class="n">defines</span> <span class="n">the</span> <span class="n">variables</span> <span class="n">needed</span> <span class="n">by</span> <span class="n">the</span> <span class="n">iApp</span> <span class="n">to</span> <span class="n">create</span> <span class="n">the</span> <span class="n">service</span><span class="o">.</span> <span class="n">The</span> <span class="n">variable</span> <span class="n">names</span> <span class="ow">and</span> <span class="n">values</span> <span class="n">are</span> <span class="n">specific</span> <span class="n">to</span> <span class="n">the</span> <span class="n">template</span> <span class="n">being</span> <span class="n">used</span><span class="o">.</span> <span class="n">The</span> <span class="s2">&quot;/#create_new#&quot;</span> <span class="n">value</span> <span class="n">directs</span> <span class="n">the</span> <span class="n">service</span> <span class="n">to</span> <span class="n">create</span> <span class="n">the</span> <span class="n">resource</span><span class="p">,</span> <span class="n">otherwise</span> <span class="n">it</span> <span class="n">will</span> <span class="n">use</span> <span class="n">an</span> <span class="n">existing</span><span class="p">,</span> <span class="n">specified</span> <span class="n">resource</span><span class="o">.</span>

   <span class="n">Ex</span><span class="p">:</span> <span class="s2">&quot;F5_0_IAPP_VARIABLE_pool__addr&quot;</span><span class="p">:</span> <span class="s2">&quot;10.128.10.240&quot;</span>
   <span class="n">Ex</span><span class="p">:</span> <span class="s2">&quot;F5_0_IAPP_VARIABLE_pool__pool_to_use&quot;</span><span class="p">:</span> <span class="s2">&quot;/#create_new#&quot;</span>

<span class="n">F5_</span><span class="p">{</span><span class="n">n</span><span class="p">}</span><span class="n">_IAPP_POOL_MEMBER_TABLE_NAME</span>

   <span class="n">The</span> <span class="n">name</span> <span class="n">of</span> <span class="n">the</span> <span class="n">iApp</span> <span class="n">table</span> <span class="n">entry</span> <span class="n">that</span> <span class="n">specifies</span> <span class="n">the</span> <span class="n">pool</span> <span class="n">members</span><span class="p">:</span> <span class="n">THIS</span> <span class="n">NAME</span> <span class="n">IS</span> <span class="n">NOT</span> <span class="n">STANDARD</span> <span class="n">AND</span> <span class="n">CAN</span> <span class="n">BE</span> <span class="n">DIFFERENT</span> <span class="n">FOR</span> <span class="n">EACH</span> <span class="n">iApp</span> <span class="n">TEMPLATE</span><span class="o">.</span>
   <span class="n">Ex</span><span class="p">:</span> <span class="s2">&quot;F5_0_IAPP_POOL_MEMBER_TABLE_NAME&quot;</span><span class="p">:</span> <span class="s2">&quot;pool__members&quot;</span>
</pre></div>
</div>
<div class="section" id="iapp-configuration-example">
<h5>iApp Configuration Example<a class="headerlink" href="#iapp-configuration-example" title="Permalink to this headline">¶</a></h5>
<p>The following shows an example Marathon app definition configured to use
the &#8220;f5.http&#8221; template to define an HTTP service. Note that the only
label needed other than the IAPP labels, is the F5_PARTITION label. The
parameters that were specified earlier for F5_0_BIND_ADDR and
F5_0_PORT are now accounted for as iApp variables (pool__addr and
pool__port, respectively).</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="p">{</span>
  <span class="s2">&quot;id&quot;</span><span class="p">:</span> <span class="s2">&quot;server-app2&quot;</span><span class="p">,</span>
  <span class="s2">&quot;cpus&quot;</span><span class="p">:</span> <span class="mf">0.1</span><span class="p">,</span>
  <span class="s2">&quot;mem&quot;</span><span class="p">:</span> <span class="mf">16.0</span><span class="p">,</span>
  <span class="s2">&quot;instances&quot;</span><span class="p">:</span> <span class="mi">4</span><span class="p">,</span>
  <span class="s2">&quot;container&quot;</span><span class="p">:</span> <span class="p">{</span>
    <span class="s2">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;DOCKER&quot;</span><span class="p">,</span>
    <span class="s2">&quot;docker&quot;</span><span class="p">:</span> <span class="p">{</span>
      <span class="s2">&quot;image&quot;</span><span class="p">:</span> <span class="s2">&quot;edarzins/node-web-app&quot;</span><span class="p">,</span>
      <span class="s2">&quot;network&quot;</span><span class="p">:</span> <span class="s2">&quot;BRIDGE&quot;</span><span class="p">,</span>
      <span class="s2">&quot;forcePullImage&quot;</span><span class="p">:</span> <span class="n">false</span><span class="p">,</span>
      <span class="s2">&quot;portMappings&quot;</span><span class="p">:</span> <span class="p">[</span>
        <span class="p">{</span> <span class="s2">&quot;containerPort&quot;</span><span class="p">:</span> <span class="mi">8088</span><span class="p">,</span>
          <span class="s2">&quot;hostPort&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
          <span class="s2">&quot;protocol&quot;</span><span class="p">:</span> <span class="s2">&quot;tcp&quot;</span> <span class="p">}</span>
      <span class="p">]</span>
    <span class="p">}</span>
  <span class="p">},</span>
  <span class="s2">&quot;labels&quot;</span><span class="p">:</span> <span class="p">{</span>
    <span class="s2">&quot;F5_PARTITION&quot;</span><span class="p">:</span> <span class="s2">&quot;mesos&quot;</span><span class="p">,</span>
    <span class="s2">&quot;F5_0_IAPP_TEMPLATE&quot;</span><span class="p">:</span> <span class="s2">&quot;/Common/f5.http&quot;</span><span class="p">,</span>
    <span class="s2">&quot;F5_0_IAPP_POOL_MEMBER_TABLE_NAME&quot;</span><span class="p">:</span> <span class="s2">&quot;pool__members&quot;</span><span class="p">,</span>
    <span class="s2">&quot;F5_0_IAPP_VARIABLE_net__server_mode&quot;</span><span class="p">:</span> <span class="s2">&quot;lan&quot;</span><span class="p">,</span>
    <span class="s2">&quot;F5_0_IAPP_VARIABLE_pool__addr&quot;</span><span class="p">:</span> <span class="s2">&quot;10.128.10.240&quot;</span><span class="p">,</span>
    <span class="s2">&quot;F5_0_IAPP_VARIABLE_pool__pool_to_use&quot;</span><span class="p">:</span> <span class="s2">&quot;/#create_new#&quot;</span><span class="p">,</span>
    <span class="s2">&quot;F5_0_IAPP_VARIABLE_monitor__monitor&quot;</span><span class="p">:</span> <span class="s2">&quot;/#create_new#&quot;</span><span class="p">,</span>
    <span class="s2">&quot;F5_0_IAPP_VARIABLE_monitor__uri&quot;</span><span class="p">:</span> <span class="s2">&quot;/&quot;</span><span class="p">,</span>
    <span class="s2">&quot;F5_0_IAPP_VARIABLE_monitor__response&quot;</span><span class="p">:</span> <span class="s2">&quot;none&quot;</span><span class="p">,</span>
    <span class="s2">&quot;F5_0_IAPP_VARIABLE_net__client_mode&quot;</span><span class="p">:</span> <span class="s2">&quot;wan&quot;</span><span class="p">,</span>
    <span class="s2">&quot;F5_0_IAPP_VARIABLE_pool__port&quot;</span><span class="p">:</span> <span class="s2">&quot;8080&quot;</span><span class="p">,</span>
    <span class="s2">&quot;F5_0_IAPP_OPTION_description&quot;</span><span class="p">:</span> <span class="s2">&quot;This is a test iApp&quot;</span>
  <span class="p">},</span>
  <span class="s2">&quot;healthChecks&quot;</span><span class="p">:</span> <span class="p">[</span>
    <span class="p">{</span>
      <span class="s2">&quot;protocol&quot;</span><span class="p">:</span> <span class="s2">&quot;TCP&quot;</span><span class="p">,</span>
      <span class="s2">&quot;portIndex&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
      <span class="s2">&quot;path&quot;</span><span class="p">:</span> <span class="s2">&quot;/&quot;</span><span class="p">,</span>
      <span class="s2">&quot;gracePeriodSeconds&quot;</span><span class="p">:</span> <span class="mi">5</span><span class="p">,</span>
      <span class="s2">&quot;intervalSeconds&quot;</span><span class="p">:</span> <span class="mi">20</span><span class="p">,</span>
      <span class="s2">&quot;maxConsecutiveFailures&quot;</span><span class="p">:</span> <span class="mi">3</span>
    <span class="p">}</span>
  <span class="p">]</span>
<span class="p">}</span>
</pre></div>
</div>
</div>
</div>
</div>
</div>
</div>


           </div>
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="../lightweight-proxy/index.html" class="btn btn-neutral float-right" title="Light Weight Proxy (LWP)" accesskey="n">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="../index.html" class="btn btn-neutral" title="Welcome to F5 Container Integrations’s documentation!" accesskey="p"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2016, F5 Networks.

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/snide/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  

    <script type="text/javascript">
        var DOCUMENTATION_OPTIONS = {
            URL_ROOT:'../',
            VERSION:'0.1_a',
            COLLAPSE_INDEX:false,
            FILE_SUFFIX:'.html',
            HAS_SOURCE:  true
        };
    </script>
      <script type="text/javascript" src="../_static/jquery.js"></script>
      <script type="text/javascript" src="../_static/underscore.js"></script>
      <script type="text/javascript" src="../_static/doctools.js"></script>

  

  
  
    <script type="text/javascript" src="../_static/js/theme.js"></script>
  

  
  
  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.StickyNav.enable();
      });
  </script>
   

</body>
</html>